{#
 # This file is part of MedShakeEHR.
 #
 # Copyright (c) 2017
 # Bertrand Boutillier <b.boutillier@gmail.com>
 # http://www.medshake.net
 #
 # MedShakeEHR is free software: you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation, either version 3 of the License, or
 # any later version.
 #
 # MedShakeEHR is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with MedShakeEHR.  If not, see <http://www.gnu.org/licenses/>.
 #/

/##
 # Template > patient : formulaire d'envoi de mail
 #
 # @author Bertrand Boutillier <b.boutillier@gmail.com>
 # @contrib fr33z00 <https://github.com/fr33z00>
 #}

{% import "macroForm.html.twig" as f %}
{# Formulaire de synthèse #}
<div class="jumbotron col-md-12">
    <button id="cleanNewMail" type="button" class="close" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>

    {% if page.form.addHidden.mailType == 'ns' %}
        <h3>Envoyer par mail non sécurisé</h3>
    {% elseif page.form.addHidden.mailType == 'apicrypt' %}
        <h3>Envoyer par mail Apicrypt</h3>
    {% elseif page.form.addHidden.mailType == 'ecofax' %}
        <h3>Envoyer par fax</h3>
    {% endif %}

    {% if page.doc %}
      <ul class="nav nav-pills my-3" role="tablist">
        <li class="nav-item">
          {% if page.form.addHidden.mailType == 'ecofax' %}
            <a class="nav-link active" id="mailRedaction-tab" data-toggle="tab" href="#mailRedaction" role="tab" aria-controls="mailRedaction" aria-selected="true"><i class="fas fa-fax"></i> Destinataire</a>
          {% else %}
            <a class="nav-link active" id="mailRedaction-tab" data-toggle="tab" href="#mailRedaction" role="tab" aria-controls="mailRedaction" aria-selected="true"><i class="fas fa-envelope"></i> Message</a>
          {% endif %}
        </li>
        <li class="nav-item">
          {% if page.form.addHidden.mailType == 'ecofax' %}
            <a class="nav-link" id="mailPj-tab" data-toggle="tab" href="#mailPj" role="tab" aria-controls="mailPj" aria-selected="false"><i class="fas fa-paperclip"></i> Document <small>({{ page.doc.filesize|e }})</small></a>
          {% else %}
            <a class="nav-link" id="mailPj-tab" data-toggle="tab" href="#mailPj" role="tab" aria-controls="mailPj" aria-selected="false"><i class="fas fa-paperclip"></i> Pièce jointe <small>({{ page.doc.filesize|e }})</small></a>
          {% endif %}
        </li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="mailRedaction" role="tabpanel" aria-labelledby="mailRedaction-tab">
          {{ f.formbuilder(page.form , page.formIN ) }}
        </div>

        <div class="tab-pane fade" id="mailPj" role="tabpanel" aria-labelledby="mailPj-tab">
          <p>Document à expédier :
              {{ page.doc.label|e }}
              {{ page.doc.titre|e }}
              <small>(Taille : {{ page.doc.filesize|e }})</small>
              <a class="btn btn-secondary btn-sm" role="button" href="{{ config.protocol }}{{ config.host }}{{ config.urlHostSuffixe }}/{{ page.doc.url }}" target="_blank" title="Voir">
                <span class="fa fa-external-link-alt" aria-hidden="true"></span> Voir
              </a>
          </p>

          <object data="{{ config.protocol }}{{ config.host }}{{ config.urlHostSuffixe }}/{{ page.doc.url }}" type="{{ page.doc.mimetype }}" width="900px" height="900px" style="border: 15px solid #DDD">
          </object>

        </div>
      </div>

    {% else %}
      {{ f.formbuilder(page.form , page.formIN ) }}
    {% endif %}
</div>
